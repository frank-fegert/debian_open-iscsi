Index: open-iscsi/usr/Makefile
===================================================================
--- open-iscsi.orig/usr/Makefile	2011-08-23 13:13:30.810531599 +0530
+++ open-iscsi/usr/Makefile	2011-08-23 13:15:18.387924908 +0530
@@ -31,7 +31,7 @@
 OPTFLAGS ?= -O2 -g
 WARNFLAGS ?= -Wall -Wstrict-prototypes
 CFLAGS += $(OPTFLAGS) $(WARNFLAGS) -I../include -I. -I../utils/open-isns \
-					-D$(OSNAME) $(IPC_CFLAGS)
+					-D$(OSNAME) $(IPC_CFLAGS) -DISNS_ENABLE
 PROGRAMS = iscsid iscsiadm iscsistart
 
 # libc compat files
Index: open-iscsi/usr/discovery.c
===================================================================
--- open-iscsi.orig/usr/discovery.c	2011-08-23 13:13:30.810531599 +0530
+++ open-iscsi/usr/discovery.c	2011-08-23 13:15:18.387924908 +0530
@@ -44,9 +44,11 @@
 #include "iscsid_req.h"
 #include "iscsi_util.h"
 /* libisns includes */
+#ifdef ISNS_ENABLE
 #include "isns.h"
 #include "paths.h"
 #include "message.h"
+#endif
 
 #ifdef SLP_ENABLE
 #include "iscsi-slp-discovery.h"
@@ -93,6 +95,7 @@
 	return 0;
 }
 
+#ifdef ISNS_ENABLE
 void discovery_isns_free_servername(void)
 {
 	if (isns_config.ic_server_name)
@@ -366,6 +369,7 @@
 	discovery_isns_free_servername();
 	return rc;
 }
+#endif
 
 int discovery_fw(void *data, struct iface_rec *iface,
 		 struct list_head *rec_list)
Index: open-iscsi/Makefile
===================================================================
--- open-iscsi.orig/Makefile	2011-08-23 13:15:29.548069319 +0530
+++ open-iscsi/Makefile	2011-08-23 13:15:57.500430898 +0530
@@ -27,7 +27,7 @@
 all: user kernel
 
 user: ;
-	cd utils/open-isns; ./configure; $(MAKE)
+	cd utils/open-isns; ./configure --with-security=no --with-slp=no; $(MAKE)
 	$(MAKE) -C utils/sysdeps
 	$(MAKE) -C utils/fwparam_ibft
 	$(MAKE) -C usr
